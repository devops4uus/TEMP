pipeline{
    agent{
        label "kworker2"
    }

	environment {
        PEM_PATH = "${env.WORKSPACE}"
        CONFIG_PATH = "${env.WORKSPACE}/rel/files"
		OLD_STRING = "{{node_name}}"

    }	

    stages{
	
		stage("cleanup workspace") {
			steps {
				cleanWs()
		
			}
			}
        stage("Code Checkout"){
            steps{
                checkout([$class: 'GitSCM',
                    branches: [[name: '*/kube-cluster']],
                    doGenerateSubmoduleConfigurations: false, 
                    extensions: [], submoduleCfg: [],
                    userRemoteConfigs: [[credentialsId: 'github-cred', url: "https://github.com/devops4uus/TEMP.git"]]])
                 }

                                 }

        stage("Ansible-deployment"){
            steps{
        //    ansiblePlaybook(credentialsId: 'devops-ansible', inventory: 'hosts.ini', playbook: 'deploy.yml')
            ansiblePlaybook( 
        playbook: 'deploy.yml',
        inventory: 'hosts.ini', 
        credentialsId: 'devops-ansible',
        colorized: true) 
            }
        }
        }                         

           }